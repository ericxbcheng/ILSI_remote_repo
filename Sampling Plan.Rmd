---
title: 'Sampling: Sampling Plan'
author: "Xianbin Cheng"
date: "September 7, 2018"
output: html_document
---

# Method

1. Load libraries and source R code from `Sampling_contamination.R`.

```{r, message = FALSE, warning = FALSE}
library(reshape2)
library(kableExtra)
```

```{r, warning = FALSE, message = FALSE}
source(file = "Sampling_contamination.R")
```

```{r}
sessionInfo()
```

```{r}
## Basic info of the contamination simulation
str(contam_xy)

summary(contam_xy$label)
```


2. List important parameters from `Sampling_contamination.R`.

* `n_sim` = the number of simulations  
* `x_lim` = the limits of the horizontal axis  
* `y_lim` = the limits of the vertical axis  
* `x` = the horizontal coordinate of the contamination center, which follows a uniform distribution (`U(0,1)`)
* `y` = the vertical coordinate of the contamination center, which follows a uniform distribution(`U(0,1)`)  

** Mode 1: Discrete Spread** 

* `n_affected` = the number of affected plants near the contamination spot, which follows a Poisson distribution (`Pois(lambda = 5)`)   
* `covar_mat` = covariance matrix of `x` and `y`, which defines the spread of contamination. Assume the spread follows a 2D normal distribution with var(X) = 0.25, var(Y) = 0.25 and cov(X, Y) = 0  

** Mode 2: Continuous Spread**

* `spread_radius` = the radius of the contamination spread

```{r}
n_sim
x_lim
y_lim

## Mode 1
n_affected
covar_mat

## Mode 2
spread_radius
```

3. Define parameters for generating sampling plans.

* `n_sp` = the number of sampling points
* `sp_radius` = the radius (m) of a circular region around the sample point. (Only applicable to **Mode 1: Discrete Spread**)

```{r}
n_sp = 10
sp_radius = 1
```

4. Simulate a sampling plan. In this case, we simulate a simple random sampling plan. The coordinates of sampling points follows a uniform distribution $U(0,1)$.

```{r}
# Run this if we want reproducibility
#set.seed(123)
```

```{r}
# Create a function that generates a simple random sampling plan
sim_plan = function(n_sp, x_lim, y_lim, radius){
  
  ## Generate a data frame that contains the coordinates of the sampling points
  x_sp = runif(n = n_sp, min = x_lim[1], max = x_lim[2])
  y_sp = runif(n = n_sp, min = y_lim[1], max = y_lim[2])
  
  ## Generate a unique identifier for each sample point
  a = rep("sp", times = n_sp)
  b = 1:n_sp %>% as.character()
  ID = paste(a, "-", b, sep = "")
  
  ## Generate a column for sample radius
  r = rep(radius, times = n_sp)
  
  data.frame(X = x_sp,
             Y = y_sp,
             ID = ID,
             label = "sample point",
             r = r)
}
```

```{r}
sp_xy = sim_plan(n_sp = n_sp, x_lim = x_lim, y_lim = y_lim, r = sp_radius)
```

5. Combine the `sp_xy` and `contam_xy` by row.

```{r}
contam_sp_xy = rbind(contam_xy, sp_xy)
rownames(contam_sp_xy) = NULL
```

# Results

1. Show the simulated contamination.

```{r}
# Mode 1: Discrete Spread
plot_contam_dis

# Mode 2: Continuous Spread
plot_contam_cont
```

2. Show the sample points and sample regions.

```{r}
plot_sp_dis = ggplot() +
  geom_point(data = sp_xy, aes(x = X, y = Y, color = label, shape = label)) +
  scale_color_manual(values = c("darkgreen")) +
  scale_shape_manual(values = 4) +
  geom_circle(data = sp_xy, aes(x0 = X, y0 = Y, r = r), fill = "darkgreen", alpha = 0.1) +
  coord_fixed(ratio = 1, xlim = x_lim, ylim = y_lim) +
  theme_bw()

plot_sp_cont = ggplot() +
  geom_point(data = sp_xy, aes(x = X, y = Y, color = label, shape = label)) +
  scale_color_manual(values = c("darkgreen")) +
  scale_shape_manual(values = 4) +
  coord_fixed(ratio = 1, xlim = x_lim, ylim = y_lim) +
  theme_bw()
```

```{r}
# Sampling plan for continuous spread
plot_sp_cont

# Sampling plan for discrete spread
plot_sp_dis
```


3. Overlay the sampling plan on the simulated contamination plot.

```{r}
plot_overlay_cont = ggplot() +
  geom_point(data = subset(x = contam_sp_xy, subset = label != "spread"), 
             aes(x = X, y = Y, 
                 color = label, 
                 shape = label)) +
  scale_color_manual(values = c("coral", "darkgreen")) +
  scale_shape_manual(values = c(16, 4)) +
  geom_circle(data = subset(x = contam_sp_xy, subset = label == "spot"),
              aes(x0 = X, y0 = Y, r = r), 
              fill = "coral", 
              alpha = 0.1) +
  coord_fixed(ratio = 1, xlim = x_lim, ylim = y_lim) +
  theme_bw()

plot_overlay_dis = ggplot() +
  geom_point(data = contam_sp_xy, aes(x = X, y = Y, color = label, shape = label)) +
  scale_color_manual(values = c("coral", "cornflowerblue", "darkgreen")) +
  scale_shape_manual(values = c(16, 16, 4)) +
  geom_circle(data = subset(x = contam_sp_xy, subset = label == "sample point"),
              aes(x0 = X, y0 = Y, r = r),
              fill = "darkgreen",
              alpha = 0.1) +
  coord_fixed(ratio = 1, xlim = x_lim, ylim = y_lim) +
  theme_bw()
```

```{r}
# Sampling plan for continuous spread
plot_overlay_cont

# Sampling plan for discrete spread
plot_overlay_dis
```

