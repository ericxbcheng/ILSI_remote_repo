---
title: "Sampling Outcome"
author: "Xianbin Cheng"
date: "September 10, 2018"
output: html_document
---

# Method  

1. Load libraries and source R code from `Sampling_plan.R`.

```{r}
source("Sampling_plan.R")
```

```{r}
sessionInfo()
```

2. List important parameters from `Sampling_contamination.R` and `Sampling_plan.R`.

**Contamination:**  

  * `n_sim` = the number of simulations  
  * `x_lim` = the limits of the horizontal axis  
  * `y_lim` = the limits of the vertical axis  
  * `x` = the horizontal coordinate of the contamination center, which follows a uniform distribution (`U(0,1)`)
  * `y` = the vertical coordinate of the contamination center, which follows a uniform distribution(`U(0,1)`)  

  **Mode 1: Discrete Spread** 

  * `n_affected` = the number of affected plants near the contamination spot, which follows a Poisson distribution (`Pois(lambda = 5)`)   
  * `covar_mat` = covariance matrix of `x` and `y`, which defines the spread of contamination. Assume the spread follows a 2D normal distribution with var(X) =     0.25, var(Y) = 0.25 and cov(X, Y) = 0  

  **Mode 2: Continuous Spread**

  * `spread_radius` = the radius of the contamination spread

**Sampling Plan:**  

  * `n_sp` = the number of sampling points
  * `sp_radius` = the radius (m) of a circular region around the sample point. (Only applicable to **Mode 1: Discrete Spread**)

```{r}
n_sim
x_lim
y_lim
n_affected
covar_mat
spread_radius
n_sp
sp_radius
```
```{r}
kable_styling(kable(subset(contam_sp_xy, select = -r), format = "html"), full_width = FALSE)
```



2. Calculate the Euclidean distance between points. 

```{r}
dist_mat = dist(x = contam_sp_xy[ ,1:2], method = "euclidean") %>% as.matrix()
```

```{r}
dist_mat[1:5, 1:5]
```

3. Extract out the distances between sample points and contamination points. Reshape the matrix into a long data frame.

```{r}
sp_ind = which(contam_sp_xy$label == "sample point")

dist_contam_sp = dist_mat[-sp_ind, sp_ind] %>%
  melt(data = ., varnames = c("row_contam", "row_sp"), value.name = "Distance")
```

```{r}
str(dist_contam_sp)
```

4. Determine the sample points whose sample region covers at least one contamination point (spot or spread).

```{r}
cover = dist_contam_sp[which(dist_contam_sp$Distance <= sp_radius), ]

contam_ID = contam_sp_xy$ID[cover$row_contam]
sp_ID = contam_sp_xy$ID[cover$row_sp]

cover_2 = cbind(cover, contam_ID, sp_ID)
```

5. Find out the contamination points that are detected. Beware that the same contamination point could be covered by multiple sample regions.

```{r}
cover_uniq = cover_2 %>%
  dplyr::select(contam_ID, sp_ID, Distance) %>%
  filter(!duplicated(contam_ID)) %>%
  arrange(.data = ., contam_ID)
```


# Results  

